-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- CONFIG
local ESPColor = Color3.fromRGB(255,0,0)
local AimbotEnabled = false
local ESPEnabled = false
local LineEnabled = false
local XRayEnabled = false
local TeamCheck = true
local AimPart = "Head"
local FOVRadius = 100
local LineTarget = "Center"
local BoxThickness = 2
local LineThickness = 2

-- GUI
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "FuturisticMenu"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true

-- Floating Circle Button
local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0,60,0,60)
toggleButton.Position = UDim2.new(1,-80,0,50)
toggleButton.BackgroundColor3 = Color3.fromRGB(0,255,255)
toggleButton.Text = "≡"
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 20
toggleButton.TextColor3 = Color3.fromRGB(0,0,0)
toggleButton.AutoButtonColor = false
Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(0,30)
local stroke = Instance.new("UIStroke", toggleButton)
stroke.Color = Color3.fromRGB(0,200,255)
stroke.Thickness = 2

-- Main Menu Frame
local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0,420,0,380)
mainFrame.Position = UDim2.new(0.5,-210,0.5,-190)
mainFrame.BackgroundColor3 = Color3.fromRGB(20,20,40)
mainFrame.BackgroundTransparency = 0.1
mainFrame.Visible = false
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0,16)
local frameStroke = Instance.new("UIStroke", mainFrame)
frameStroke.Color = Color3.fromRGB(0,255,255)
frameStroke.Thickness = 2

-- Draggable Main Menu
local dragging, dragStart, startPos
mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=true
        dragStart=input.Position
        startPos=mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState==Enum.UserInputState.End then dragging=false end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType==Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
    end
end)

-- Sidebar
local sidebar=Instance.new("Frame",mainFrame)
sidebar.Size=UDim2.new(0,180,1,0)
sidebar.BackgroundColor3=Color3.fromRGB(25,25,50)
sidebar.BackgroundTransparency=0.15
Instance.new("UICorner",sidebar).CornerRadius=UDim.new(0,12)
local layout=Instance.new("UIListLayout",sidebar)
layout.Padding=UDim.new(0,10)
layout.SortOrder=Enum.SortOrder.LayoutOrder
local padding=Instance.new("UIPadding",sidebar)
padding.PaddingTop=UDim.new(0,15)
padding.PaddingLeft=UDim.new(0,12)
padding.PaddingRight=UDim.new(0,12)

-- UTILITY FUNCTIONS
local function updateButtonText(button,name,state)
    button.Text="• "..name.." : "..(state and "ON" or "OFF")
end

local function randomColor()
    return Color3.fromRGB(math.random(0,255),math.random(0,255),math.random(0,255))
end

-- CREATE BUTTON
local function makeButton(name,onClick)
    local btn=Instance.new("TextButton",sidebar)
    btn.Size=UDim2.new(1,0,0,36)
    btn.BackgroundColor3=Color3.fromRGB(30,30,60)
    btn.BackgroundTransparency=0.25
    btn.Font=Enum.Font.GothamSemibold
    btn.TextSize=15
    btn.TextColor3=Color3.fromRGB(170,255,255)
    btn.AutoButtonColor=false
    Instance.new("UICorner",btn).CornerRadius=UDim.new(0,8)
    local stroke=Instance.new("UIStroke",btn)
    stroke.Color=Color3.fromRGB(0,200,255)
    stroke.Thickness=1.5
    btn.Name=name:gsub(" ","")
    onClick(btn)
    return btn
end

-- CREATE INPUT BOX
local function makeInput(name,defaultValue,onChange)
    local box=Instance.new("TextBox",sidebar)
    box.Size=UDim2.new(1,0,0,36)
    box.BackgroundColor3=Color3.fromRGB(25,25,50)
    box.BackgroundTransparency=0.2
    box.Font=Enum.Font.GothamSemibold
    box.TextSize=15
    box.TextColor3=Color3.fromRGB(0,255,255)
    box.Text=tostring(defaultValue)
    box.PlaceholderText=name
    box.ClearTextOnFocus=false
    Instance.new("UICorner",box).CornerRadius=UDim.new(0,8)
    local stroke=Instance.new("UIStroke",box)
    stroke.Color=Color3.fromRGB(0,200,255)
    stroke.Thickness=1.5
    box.FocusLost:Connect(function()
        local num=tonumber(box.Text)
        if num then onChange(num) else box.Text=tostring(defaultValue) end
    end)
end

-- Toggle Main Menu
toggleButton.MouseButton1Click:Connect(function()
    mainFrame.Visible=not mainFrame.Visible
end)

-- FEATURE BUTTONS
local aimbotBtn=makeButton("Aimbot FOV",function(btn)
    btn.MouseButton1Click:Connect(function()
        AimbotEnabled=not AimbotEnabled
        updateButtonText(btn,"Aimbot FOV",AimbotEnabled)
    end)
    updateButtonText(btn,"Aimbot FOV",AimbotEnabled)
end)

local aimpartBtn=makeButton("Target Head/Body",function(btn)
    btn.MouseButton1Click:Connect(function()
        AimPart=AimPart=="Head" and "HumanoidRootPart" or "Head"
        btn.Text="• Target: "..AimPart
    end)
    btn.Text="• Target: "..AimPart
end)

local espBtn=makeButton("ESP / Box",function(btn)
    btn.MouseButton1Click:Connect(function()
        ESPEnabled=not ESPEnabled
        updateButtonText(btn,"ESP / Box",ESPEnabled)
    end)
    updateButtonText(btn,"ESP / Box",ESPEnabled)
end)

local lineBtn=makeButton("Line ESP",function(btn)
    btn.MouseButton1Click:Connect(function()
        LineEnabled=not LineEnabled
        updateButtonText(btn,"Line ESP",LineEnabled)
    end)
    updateButtonText(btn,"Line ESP",LineEnabled)
end)

local xrayBtn=makeButton("X-Ray",function(btn)
    btn.MouseButton1Click:Connect(function()
        XRayEnabled=not XRayEnabled
        for _,p in pairs(Workspace:GetDescendants()) do
            if p:IsA("BasePart") and p.Transparency<1 then
                p.LocalTransparencyModifier=XRayEnabled and 0.5 or 0
            end
        end
        updateButtonText(btn,"X-Ray",XRayEnabled)
    end)
    updateButtonText(btn,"X-Ray",XRayEnabled)
end)

local wsJumpBtn=makeButton("Speed / Jump",function(btn)
    btn.MouseButton1Click:Connect(function()
        local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hum=char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed=hum.WalkSpeed==16 and 50 or 16
            hum.JumpPower=hum.JumpPower==50 and 100 or 50
        end
    end)
    btn.Text="• Speed / Jump"
end)

local teamCheckBtn=makeButton("Team Check",function(btn)
    btn.MouseButton1Click:Connect(function()
        TeamCheck=not TeamCheck
        updateButtonText(btn,"Team Check",TeamCheck)
    end)
    updateButtonText(btn,"Team Check",TeamCheck)
end)

local fovSizeInput=makeInput("FOV Radius",FOVRadius,function(val) FOVRadius=val end)
local boxThicknessInput=makeInput("Box Thickness",BoxThickness,function(val) BoxThickness=val end)
local lineThicknessInput=makeInput("Line Thickness",LineThickness,function(val) LineThickness=val end)

local colorBtn=makeButton("Random ESP Color",function(btn)
    btn.MouseButton1Click:Connect(function()
        ESPColor=randomColor()
    end)
    btn.Text="• Random ESP Color"
end)

-- ESP OBJECTS
local espObjects = {}

local function createESP(target)
    local box = Drawing.new("Square")
    box.Color = ESPColor
    box.Thickness = BoxThickness
    box.Transparency = 1
    box.Filled = false

    local line = Drawing.new("Line")
    line.Color = ESPColor
    line.Thickness = LineThickness
    line.Transparency = 1

    local healthBar = Drawing.new("Line")
    healthBar.Color = Color3.fromRGB(0,255,0)
    healthBar.Thickness = 4
    healthBar.Transparency = 1

    return {
        box = box,
        line = line,
        healthBar = healthBar,
        update = function()
            local char = target.Character
            if char and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0 then
                local hrp = char.HumanoidRootPart
                local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                if onScreen then
                    local size = 50
                    box.Size = Vector2.new(size, size * 1.6)
                    box.Position = Vector2.new(pos.X - size / 2, pos.Y - size / 1.6)
                    box.Color = ESPColor
                    box.Thickness = BoxThickness
                    box.Visible = ESPEnabled

                    local toPos = (LineTarget == "Head" and char:FindFirstChild("Head") or LineTarget == "Torso" and char:FindFirstChild("HumanoidRootPart") or hrp)
                    local w2v, onScreen2 = Camera:WorldToViewportPoint(toPos.Position)
                    line.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
                    line.To = Vector2.new(w2v.X, w2v.Y)
                    line.Color = ESPColor
                    line.Thickness = LineThickness
                    line.Visible = LineEnabled

                    -- Health Bar
                    local hum = char:FindFirstChildOfClass("Humanoid")
                    if hum then
                        local healthPercent = hum.Health / hum.MaxHealth
                        healthBar.From = Vector2.new(pos.X - size/2, pos.Y - size/1.6 - 10)
                        healthBar.To = Vector2.new(pos.X - size/2 + size * healthPercent, pos.Y - size/1.6 - 10)
                        healthBar.Visible = ESPEnabled
                    else
                        healthBar.Visible = false
                    end
                else
                    box.Visible=false
                    line.Visible=false
                    healthBar.Visible=false
                end
            else
                box.Visible=false
                line.Visible=false
                healthBar.Visible=false
            end
        end
    }
end

local function setupESP(player)
    if player == LocalPlayer then return end
    local espObj = createESP(player)
    espObjects[player] = espObj
end

for _,p in pairs(Players:GetPlayers()) do setupESP(p) end
Players.PlayerAdded:Connect(setupESP)

-- TARGETING FUNCTION
local function getClosest()
    local closest, shortest = nil, math.huge
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild(AimPart) then
            if TeamCheck and p.Team == LocalPlayer.Team then continue end
            local pos, onScreen = Camera:WorldToViewportPoint(p.Character[AimPart].Position)
            if onScreen then
                local dist = (Vector2.new(pos.X,pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                if dist < shortest and dist < FOVRadius then
                    shortest = dist
                    closest = p
                end
            end
        end
    end
    return closest
end

-- FOV Circle
local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.fromRGB(255,0,0)
fovCircle.Thickness = 2
fovCircle.Transparency = 1
fovCircle.Filled = false
fovCircle.Radius = FOVRadius
fovCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

-- MAIN LOOP
RunService.RenderStepped:Connect(function()
    fovCircle.Visible = AimbotEnabled
    fovCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    fovCircle.Radius = FOVRadius

    for _, obj in pairs(espObjects) do obj.update() end

    if AimbotEnabled then
        local target = getClosest()
        if target and target.Character and target.Character:FindFirstChild(AimPart) then
            local part = target.Character[AimPart]
            local dir = (part.Position - Camera.CFrame.Position).Unit
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, Camera.CFrame.Position + dir)
        end
    end
end)
