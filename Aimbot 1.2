local library = loadstring(game:GetObjects("rbxassetid://7657867786")[1].Source)()
local Wait = library.subs.Wait

local PepsisWorld = library:CreateWindow({
    Name = "Teppitakvittaya",
    Themeable = { Info = "Discord Server: VzYTJ7Y" }
})

local GeneralTab = PepsisWorld:CreateTab({ Name = "General" })

-- Farming Section
local FarmingSection = GeneralTab:CreateSection({ Name = "Farming" })
FarmingSection:AddToggle({ Name = "Aimbot", Flag = "FarmingSection_Aimbot" })
FarmingSection:AddSlider({ Name = "Aimbot FOV", Flag = "FarmingSection_AimbotFOV", Value = 100, Min = 50, Max = 500, Textbox = true, Format = function(v) return "FOV: "..v end })
FarmingSection:AddToggle({ Name = "Fov", Flag = "FarmingSection_Fov" })
FarmingSection:AddSlider({ Name = "Size Fov", Flag = "FarmingSection_SizeFoV", Value = 2, Min = 1, Max = 10, Textbox = true })
FarmingSection:AddToggle({ Name = "Thinness of the line", Flag = "FarmingSection_Thinnessoftheline" })
FarmingSection:AddToggle({ Name = "Find Player", Flag = "FarmingSection_FindPlayer" })
FarmingSection:AddSlider({
    Name = "Lock Player",
    Flag = "FarmingSection_LockPlayer",
    Value = 175, Min = 0, Max = 200, Textbox = true,
    Format = function(v) return v==0 and "Lock Distance: Infinite" or "Lock Distance: "..v end
})

-- Settings Section
local SettingsSection = GeneralTab:CreateSection({ Name = "Settings" })
SettingsSection:AddToggle({ Name = "Anti Trip/Ragdoll", Flag = "SettingsSection_AntiTripRagdoll" })
SettingsSection:AddToggle({ Name = "No Wear & Tear", Flag = "SettingsSection_NoWearTear" })
SettingsSection:AddToggle({ Name = "No Trick Cooldown", Flag = "SettingsSection_NoTrickCooldown" })
SettingsSection:AddToggle({ Name = "Extend Combo Timout", Flag = "SettingsSection_ExtendComboTimeout" })
SettingsSection:AddSlider({ Name = "Timeout Extension", Flag = "SettingsSection_TimeoutExtension", Value = 3, Min = 0, Max = 20, Textbox = true, Format = function(v) return v==0 and "Combo Timeout: Never" or "Combo Timeout: "..v.."s" end })

-- Misc Section
local MiscSection = GeneralTab:CreateSection({ Name = "Misc", Side = "Right" })
MiscSection:AddToggle({ Name = "Unlock Gamepasses", Flag = "MiscSection_UnlockGamepasses" })
MiscSection:AddToggle({ Name = "Auto Compete", Flag = "MiscSection_AutoCompete" })
MiscSection:AddButton({ Name = "Repair Board", Callback = function() print("Fixed") end })
MiscSection:AddKeybind({ Name = "Test Key", Callback = print })
MiscSection:AddToggle({ Name = "Test Toggle/Key", Keybind = { Mode = "Dynamic" }, Callback = print })

-- Fun Cosmetics
local FunSection = GeneralTab:CreateSection({ Name = "Fun Cosmetics" })
FunSection:AddToggle({ Name = "Ragdoll Assumes Flight", Flag = "FunSection_AssumesFlight" })
FunSection:AddToggle({ Name = "Ragdoll On Player Collision", Flag = "FunSection_RagdollOnPlayerCollision" })
FunSection:AddToggle({ Name = "Un-Ragdoll When Motionless", Flag = "FunSection_UnRagdollWhenMotionless" })
FunSection:AddToggle({ Name = "Extend Ragdoll Duration", Flag = "FunSection_ExtendRagdollDuration" })
FunSection:AddSlider({ Name = "Ragdoll Extension", Flag = "FunSection_RagdollExtension", Value = 4, Min = 0, Max = 60, Textbox = true, Format = function(v) return v==0 and "Ragdoll Extension: Indefinite" or "Ragdoll Extension: "..v.."s" end })

-- ESP Section
local ESPSection = GeneralTab:CreateSection({ Name = "ESP" })
ESPSection:AddToggle({ Name = "Enable ESP", Flag = "ESP_Enabled" })
local ESPFeatures = {"Box","Name","Health","Distance","Head Dot","Tracer","Skeleton","Highlight","Glow"}
for _, feature in pairs(ESPFeatures) do
    ESPSection:AddToggle({ Name = feature, Flag = "ESP_"..feature:gsub(" ","") })
    ESPSection:AddSlider({ Name = feature.." Size/Thickness", Flag = "ESP_"..feature.."Size", Value = 1, Min = 1, Max = 20, Textbox = true })
end

-- TeamCheck Section แบบง่าย
local TeamSection = GeneralTab:CreateSection({ Name = "TeamCheck", Side = "Right" })
TeamSection:AddToggle({ Name = "Enable TeamCheck", Flag = "ESP_TeamCheck" })

-- Services
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- FOV Circle
local Circle = Drawing.new("Circle")
Circle.NumSides = 64
Circle.Filled = false
Circle.Color = Color3.fromRGB(255,0,0)
Circle.Transparency = 1
Circle.Visible = true

local function GetClosestPlayer(FOV, distanceLimit)
    local closest, dist = nil, math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local pos, visible = Camera:WorldToViewportPoint(player.Character.Head.Position)
            if visible then
                local magnitude = (Vector2.new(pos.X,pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).magnitude
                if magnitude < FOV and magnitude < dist then
                    local distance = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                    if distanceLimit == 0 or distance < distanceLimit then
                        closest = player
                        dist = magnitude
                    end
                end
            end
        end
    end
    return closest
end

-- Dynamic ESP
local ESPPlayers = {}
local function CreateESP(player)
    if ESPPlayers[player] then return ESPPlayers[player] end
    local esp = {}
    esp.Box = Drawing.new("Square"); esp.Box.Filled=false; esp.Box.Color=Color3.fromRGB(255,0,0)
    esp.Name = Drawing.new("Text"); esp.Name.Center=true; esp.Name.Color=Color3.fromRGB(255,255,255); esp.Name.Outline=true
    esp.Health = Drawing.new("Text"); esp.Health.Center=true; esp.Health.Color=Color3.fromRGB(0,255,0); esp.Health.Outline=true
    esp.Distance = Drawing.new("Text"); esp.Distance.Center=true; esp.Distance.Color=Color3.fromRGB(255,255,0); esp.Distance.Outline=true
    esp.HeadDot = Drawing.new("Circle"); esp.HeadDot.Filled=true; esp.HeadDot.Color=Color3.fromRGB(255,0,0)
    esp.Tracer = Drawing.new("Line"); esp.Tracer.Color=Color3.fromRGB(255,255,255)
    ESPPlayers[player] = esp
    return esp
end

Players.PlayerRemoving:Connect(function(player)
    local esp = ESPPlayers[player]
    if esp then
        for _, v in pairs(esp) do if v and v.Visible ~= nil then v.Visible=false end end
        ESPPlayers[player] = nil
    end
end)

-- UI Toggle Button (Right-Top)
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
local ToggleButton = Instance.new("TextButton", ScreenGui)
ToggleButton.Size = UDim2.new(0,100,0,40)
ToggleButton.Position = UDim2.new(1,-110,0,10)
ToggleButton.Text = "Toggle"
ToggleButton.BackgroundColor3 = Color3.fromRGB(30,30,30)
ToggleButton.TextColor3 = Color3.fromRGB(255,255,255)
ToggleButton.TextScaled = true
ToggleButton.BorderSizePixel = 0
local menuVisible = true
ToggleButton.MouseButton1Click:Connect(function()
    menuVisible = not menuVisible
    PepsisWorld.MainFrame.Visible = menuVisible
end)

-- Main Render Loop
RunService.RenderStepped:Connect(function()
    -- FOV Circle
    Circle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    Circle.Radius = library.flags["FarmingSection_AimbotFOV"] or 100
    Circle.Thickness = library.flags["FarmingSection_SizeFoV"] or 2
    Circle.Visible = library.flags["FarmingSection_Fov"] or false

    -- Aimbot
    if library.flags["FarmingSection_Aimbot"] then
        local target = GetClosestPlayer(Circle.Radius, library.flags["FarmingSection_LockPlayer"] or 0)
        if target and target.Character and target.Character:FindFirstChild("Head") then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Character.Head.Position)
            if library.flags["FarmingSection_FindPlayer"] then print("Locked on:", target.Name) end
        end
    end

    -- ESP
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local esp = CreateESP(player)
            local rootPos, onScreen = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            
            -- TeamCheck แบบง่าย
            local showESP = true
            if library.flags["ESP_TeamCheck"] then
                showESP = true -- แสดงผู้เล่นคนอื่นทุกคน
            end
            
            if showESP and library.flags["ESP_Enabled"] and onScreen then
                -- Box
                if library.flags["ESP_Box"] then
                    esp.Box.Position = Vector2.new(rootPos.X-25, rootPos.Y-40)
                    esp.Box.Size = Vector2.new(50,80)
                    esp.Box.Thickness = library.flags["ESP_BoxSize"] or 1
                    esp.Box.Visible = true
                else esp.Box.Visible=false end
                -- Name
                if library.flags["ESP_Name"] then
                    esp.Name.Text = player.Name
                    esp.Name.Position = Vector2.new(rootPos.X, rootPos.Y-50)
                    esp.Name.Size = library.flags["ESP_NameSize"] or 16
                    esp.Name.Visible = true
                else esp.Name.Visible=false end
                -- Health
                if library.flags["ESP_Health"] and player.Character:FindFirstChild("Humanoid") then
                    esp.Health.Text = "HP:"..math.floor(player.Character.Humanoid.Health)
                    esp.Health.Position = Vector2.new(rootPos.X, rootPos.Y+45)
                    esp.Health.Size = library.flags["ESP_HealthSize"] or 14
                    esp.Health.Visible = true
                else esp.Health.Visible=false end
                -- Distance
                if library.flags["ESP_Distance"] then
                    esp.Distance.Text = "Dist:"..math.floor((LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude)
                    esp.Distance.Position = Vector2.new(rootPos.X, rootPos.Y+60)
                    esp.Distance.Size = library.flags["ESP_DistanceSize"] or 14
                    esp.Distance.Visible = true
                else esp.Distance.Visible=false end
                -- Head Dot
                if library.flags["ESP_HeadDot"] and player.Character:FindFirstChild("Head") then
                    local headPos = Camera:WorldToViewportPoint(player.Character.Head.Position)
                    esp.HeadDot.Position = Vector2.new(headPos.X, headPos.Y)
                    esp.HeadDot.Radius = library.flags["ESP_HeadDotSize"] or 4
                    esp.HeadDot.Visible = true
                else esp.HeadDot.Visible=false end
                -- Tracer
                if library.flags["ESP_Tracer"] then
                    esp.Tracer.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    esp.Tracer.To = Vector2.new(rootPos.X, rootPos.Y)
                    esp.Tracer.Thickness = library.flags["ESP_TracerSize"] or 1
                    esp.Tracer.Visible = true
                else esp.Tracer.Visible=false end
            else
                for _, v in pairs(esp) do if v and v.Visible~=nil then v.Visible=false end end
            end
        end
    end
end)
